import React, { useEffect, useMemo, useRef } from 'react';
import { Home, Plus, User, X, LogOut } from 'lucide-react'; import type { Page } from '@/types'; interface SidebarProps { isOpen: boolean; onClose: () => void; currentPage: string; onNavigate: (page: Page) => void;
} export default function Sidebar({ isOpen, onClose, currentPage, onNavigate }: SidebarProps) { const popoverRef = useRef<HTMLDivElement | null>(null); const supportsPopover = useMemo(() => { if (typeof window === 'undefined') return false; return 'showPopover' in HTMLElement.prototype; }, []); const menuItems = [ { id: 'home', label: 'ホーム', icon: Home }, { id: undefined, label: '投稿', icon: Plus }, { id: 'my-page', label: 'マイページ', icon: User }, ]; const handleNavigate = (page: Page) => { onClose(); onNavigate(page); }; useEffect(() => { if (!supportsPopover) return; const node = popoverRef.current as any; if (!node) return; if (isOpen) { node.showPopover?.(); } else { node.hidePopover?.(); } }, [supportsPopover, isOpen]); useEffect(() => { if (!supportsPopover) return; const node = popoverRef.current; if (!node) return; const handleToggle = (event: any) => { if (event?.newState === 'closed') { onClose(); } }; node.addEventListener('toggle', handleToggle as EventListener); return () => node.removeEventListener('toggle', handleToggle as EventListener); }, [supportsPopover, onClose]); if (supportsPopover) { return ( <div id="sidebar-overlay" ref={popoverRef} // @ts-ignore -- popover is a native attribute not yet in TypeScript DOM typings popover="auto" data-sidebar="true" role="navigation" label="メインメニュー" onClick={(e) => e.stopPropagation()}> <nav> {menuItems.map((item) => { const Icon = item.icon; const isActive = currentPage === item.id; return ( <button key={item.id} onClick={() => handleNavigate(item.id as Page)} current={isActive ? "page" : undefined}> <Icon /> <span>{item.label}</span> </button> ); })} </nav> </div> ); } return ( <aside id="sidebar-overlay" data-sidebar="true" style={{ visibility: isOpen ? 'visible' : 'hidden' }} onClick={(e) => e.stopPropagation()} label="メインメニュー"> <nav> {menuItems.map((item) => { const Icon = item.icon; const isActive = currentPage === item.id; return ( <button key={item.id} onClick={() => handleNavigate(item.id as Page)} current={isActive ? "page" : undefined}> <Icon /> <span>{item.label}</span> </button> ); })} </nav> </aside> );
}
